---
title: "5 Ways to Effectively Visualize Survey Data"
description: |
  Computerized adaptive testing (CAT) is a sophisticated methodology to create measurement instruments that are highly accurate and efficient. In this post, I explain how to evaluate the feasibility of creating a computerized adaptive version of a psychological instrument. 
  ```{r, include=FALSE}
  bytes <- file.size("5-ways-to-effectively-visualize-survey-data.Rmd")
  words <- bytes/10
  minutes <- words/200
  ``` 
  (`r round(minutes)` min read)
author:
  - name: Okan Bulut
    url: http://www.okanbulut.com/
    affiliation: University of Alberta
    affiliation_url: https://www.ualberta.ca
    orcid_id: 0000-0001-5853-1267
date: 03-04-2021
categories:
  - survey
  - data visualization
preview: survey.png
bibliography: survey.bib
csl: apa.csl
output:
  distill::distill_article:
    self_contained: false
    toc: true
draft: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, warning = FALSE, message = FALSE)
suppressWarnings({
  library("rmarkdown")
  library("kableExtra")
  library("emo")
  library("dplyr")
  library("ggplot2")
  library("corrplot")
  library("ggcorrplot")
  library("likert")
  library("naniar")
  library("reshape2")
  library("ggalluvial")
})
```


![Photo by [200degrees](https://pixabay.com/users/200degrees-2051452/) on [pixabay](https://pixabay.com/)](survey.png)

## Introduction

In CSSE 2019, I gave a half-day training on how to visualize assessment and survey items effectively (the training slides are available on [my GitHub page](https://github.com/okanbulut/dataviz/raw/master/CSSE_Workshop.pdf))^[The other training materials are available at <https://github.com/okanbulut/dataviz>.].


```{r dataviz, echo = FALSE, fig.cap="Types of data visualization (Source: https://extremepresentation.com/)", out.extra="class=external", fig.width=6, fig.height=4, layout="l-body-outset"}
# Visual summary of results
knitr::include_graphics("dataviz.png")
```


```{r nakeddata, echo = FALSE, fig.cap="Types of data visualization (Source: https://www.darkhorseanalytics.com/blog/data-looks-better-naked)", out.extra="class=external", fig.width=8, fig.height=6}
# Visual summary of results
knitr::include_graphics("data-ink.gif")
```

## Example

xxx

To what extent do you disagree or agree about yourself?

```{r ch0, echo=FALSE}
quest <- read.csv("questions.csv", header = TRUE, na.strings = 999)
colnames(quest) <- c("Question ID", "Question Statement")

kbl(quest) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "left")
```

Response options are:

* 1 = Strongly disagree
* 2 = Disagree
* 3 = Agree
* 4 = Strongly agree

```{r ch1, eval=FALSE}
# Read the data in R
data <- read.csv("PISA_Alberta.csv", header = TRUE, na.strings = 999)

# Preview the data
head(data)
```

```{r ch2, echo=FALSE}
# Read the data in R
data <- read.csv("PISA_Alberta.csv", header = TRUE, na.strings = 999)
paged_table(data, options = list(cols.print = 12))
```


### Correlation Matrix Plot

```{r ch3, eval=FALSE}
# Activate the package
library("corrplot")

# Correlation matrix of items
cormat <- data %>%
  select(starts_with(c("ST082", "ST034"))) %>%
  cor(., use = "pairwise.complete.obs")

# Correlation matrix plot
corrplot(cormat, # correlation matrix
         order = "hclust", # hierarchical clustering of correlations
         addrect = 2) # number of rectangles to draw around clusters
```


```{r ch4, echo=FALSE, fig.width=8, fig.height=5, fig.cap="Correlation matrix plot of the PISA survey items (using corrplot)", layout="l-body-outset"}
# Correlation matrix of items
cormat <- data %>%
  select(starts_with(c("ST082", "ST034"))) %>%
  cor(., use = "pairwise.complete.obs")

# Correlation matrix plot
corrplot(cormat, order = "hclust", addrect = 2)
```


```{r ch5, eval=FALSE}
library("ggcorrplot")

# Correlation matrix plot
ggcorrplot(cormat, # correlation matrix
           type = "lower", # print the lower part of the correlation matrix
           hc.order = TRUE, # hierarchical clustering of correlations
           lab = TRUE) # add correlation values as labels
```


```{r ch6, echo=FALSE, fig.width=8, fig.height=6, fig.cap="Correlation matrix plot of the PISA survey items (using ggcorrplot)", layout="l-body-outset"}
library("ggcorrplot")

# Correlation matrix plot
ggcorrplot(cormat, # correlation matrix
           type = "lower", # print the lower part of the correlation matrix
           hc.order = TRUE, # hierarchical clustering of correlations
           lab = TRUE) # add correlation values as labels
```

### UpSet Plot

```{r ch7, eval=FALSE}
library("dplyr") 

data <- mutate(data,
               gender = ifelse(ST004D01T == 1, "Female", "Male"),
               immigration = ifelse(is.na(IMMIG), NA, ifelse(IMMIG == 1, "Native", 
                                           ifelse(IMMIG == 2, "Second-Generation", 
                                                  "First-Generation")))) %>%
  rename(grade = ST001D01T,
         student = CNTSTUID,
         age = AGE) %>%
  select(-ST004D01T, -IMMIG)
```


```{r ch8,eval=FALSE}
library("naniar")

# Select only the survey items
gg_miss_upset(data[, 6:15], nsets = 10)
```


```{r ch9,echo=FALSE, fig.width=6, fig.height=5, layout="l-body-outset", fig.cap="An UpSet plot showing missing data patterns in the PISA dataset"}
gg_miss_upset(data[, 6:15], nsets = 10)
```

The **UpSetR** package also offers [a Shiny app](https://gehlenborglab.shinyapps.io/upsetr/) to generate UpSet plots without any coding in R. 


# Likert

```{r ch10, eval=TRUE, fig.width=8, fig.height=5, layout="l-body-outset", fig.cap="A plot of Likert items in the PISA dataset"}
library("likert")

items <- select(data, starts_with(c("ST082")))

names(items) <- c(
  ST082Q01="I prefer working as part of a team to working alone.",
  ST082Q02="I am a good listener.",
  ST082Q03="I enjoy seeing my classmates be successful.",
  ST082Q08="I take into account what others are interested in.",
  ST082Q09="I find that teams make better decisions than individuals.",
  ST082Q12="I enjoy considering different perspectives.",
  ST082Q13="I find that teamwork raises my own efficiency.",
  ST082Q14="I enjoy cooperating with peers.")

likert_recode <- function(x) {
  y <- ifelse(is.na(x), "Missing",
              ifelse(x == 1, "Strongly disagree",
                     ifelse(x == 2, "Disagree",
                            ifelse(x == 3, "Agree", "Strongly agree"))))
  
  y <- factor(y, levels = c("Strongly disagree", "Disagree", "Missing", 
                            "Agree", "Strongly agree"))
  
  return(y)
}

items_likert <- items %>%
  mutate_all(likert_recode) %>%
  likert()

plot(items_likert, ordered=FALSE, group.order=names(items))
```


### Alluvial Plot

```{r ch11, eval=FALSE}
library("reshape2")
library("ggplot2")
library("ggalluvial")

data_long <- data %>%
  # Melt data to long format
  melt(data = .,
       id.vars = c("student", "grade", "age", "gender", "immigration"),
       variable.name = "question",
       value.name = "response") %>%
  # Recode numerical responses to character strings
  mutate(response2 = (ifelse(is.na(response), "Missing",
                             ifelse(response == 1, "Strongly disagree",
                                    ifelse(response == 2, "Disagree",
                                           ifelse(response == 3, "Agree", "Strongly agree"))))),
         
         response3 = factor(response2, levels = c("Missing", "Strongly disagree", "Disagree", 
                                                  "Agree", "Strongly agree"))
         
  ) %>%
  # Summarize the data
  group_by(gender, question, response3) %>%
  summarise(Freq = n())
  

ggplot(data_long,
       aes(y = Freq, axis1 = question, axis2 = gender, axis3 = response3)) +
  geom_alluvium(aes(fill = gender), width = 1/12) +
  geom_stratum(width = 1/12, fill = "black", color = "grey") +
  geom_label(stat = "stratum", aes(label = after_stat(stratum))) +
  scale_x_discrete(limits = c("Gender", "Dept"), expand = c(.05, .05)) +
  scale_fill_brewer(type = "qual", palette = "Set1") +
  ggtitle("UC Berkeley admissions and rejections, by sex and department")
```


## Conclusion

xxx

